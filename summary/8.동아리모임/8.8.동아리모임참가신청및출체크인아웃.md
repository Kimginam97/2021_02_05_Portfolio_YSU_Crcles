## 8.8.동아리모임참가신청및출체크인아웃

### Event
```java
@Entity
@Getter
@Setter
@EqualsAndHashCode(of = "id")
public class Event {
    
    // 참가신청확인
    public void accept(Enrollment enrollment) {
        if (this.eventType == EventType.CONFIRMATIVE
                && this.limitOfEnrollments > this.getNumberOfAcceptedEnrollments()) {
            enrollment.setAccepted(true);
        }
    }

    // 참가신청취소
    public void reject(Enrollment enrollment) {
        if (this.eventType == EventType.CONFIRMATIVE) {
            enrollment.setAccepted(false);
        }
    }

}
```

### EventService
```java
@Service
@Transactional
@RequiredArgsConstructor
public class EventService {

    private final EventRepository eventRepository;
    private final ModelMapper modelMapper;
    private final EnrollmentRepository enrollmentRepository;

    /*
    * 참가신청확인
    * 참가신청취소
    * 체크인
    * 체크아웃
    * */
    public void acceptEnrollment(Event event, Enrollment enrollment) {
        event.accept(enrollment);
    }

    public void rejectEnrollment(Event event, Enrollment enrollment) {
        event.reject(enrollment);
    }

    public void checkInEnrollment(Enrollment enrollment) {
        enrollment.setAttended(true);
    }

    public void cancelCheckInEnrollment(Enrollment enrollment) {
        enrollment.setAttended(false);
    }

}
```

### EventController
```java
@Controller
@RequestMapping("/club/{path}")
@RequiredArgsConstructor
public class EventController {

    private final ClubService clubService;
    private final EventService eventService;
    private final ModelMapper modelMapper;
    private final EventValidator eventValidator;
    private final EventRepository eventRepository;
    private final ClubRepository clubRepository;
    private final EnrollmentRepository enrollmentRepository;
    
    /*
    * 참가신청확인
    * 참가신청취소
    * 체크인
    * 체크아웃
    * */
    @GetMapping("events/{eventId}/enrollments/{enrollmentId}/accept")
    public String acceptEnrollment(@CurrentAccount Account account, @PathVariable String path,
                                   @PathVariable("eventId") Event event, @PathVariable("enrollmentId") Enrollment enrollment) {
        Club club = clubService.getClubToUpdate(account, path);
        eventService.acceptEnrollment(event, enrollment);
        return "redirect:/club/" + club.getEncodedPath() + "/events/" + event.getId();
    }

    @GetMapping("/events/{eventId}/enrollments/{enrollmentId}/reject")
    public String rejectEnrollment(@CurrentAccount Account account, @PathVariable String path,
                                   @PathVariable("eventId") Event event, @PathVariable("enrollmentId") Enrollment enrollment) {
        Club club = clubService.getClubToUpdate(account, path);
        eventService.rejectEnrollment(event, enrollment);
        return "redirect:/club/" + club.getEncodedPath() + "/events/" + event.getId();
    }

    @GetMapping("/events/{eventId}/enrollments/{enrollmentId}/checkin")
    public String checkInEnrollment(@CurrentAccount Account account, @PathVariable String path,
                                    @PathVariable("eventId") Event event, @PathVariable("enrollmentId") Enrollment enrollment) {
        Club club = clubService.getClubToUpdate(account, path);
        eventService.checkInEnrollment(enrollment);
        return "redirect:/club/" + club.getEncodedPath() + "/events/" + event.getId();
    }

    @GetMapping("/events/{eventId}/enrollments/{enrollmentId}/cancel-checkin")
    public String cancelCheckInEnrollment(@CurrentAccount Account account, @PathVariable String path,
                                          @PathVariable("eventId") Event event, @PathVariable("enrollmentId") Enrollment enrollment) {
        Club club = clubService.getClubToUpdate(account, path);
        eventService.cancelCheckInEnrollment(enrollment);
        return "redirect:/club/" + club.getEncodedPath() + "/events/" + event.getId();
    }

}
```